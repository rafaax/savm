2025-05-09 23:19:42,864 - uvicorn.error - INFO - Started server process [19716]
2025-05-09 23:19:42,864 - uvicorn.error - INFO - Waiting for application startup.
2025-05-09 23:19:42,865 - __main__ - INFO - Inicializando SQLiDetector...
2025-05-09 23:19:43,121 - __main__ - ERROR - Falha na verificação: Teste falhou para: SELECT * FROM users
2025-05-09 23:19:43,121 - __main__ - CRITICAL - Falha na inicialização: Sistema não passou nos testes de verificação
Traceback (most recent call last):
  File "C:\apps\savm\src\models\sqli_detector.py", line 288, in _verify_system
    raise ValueError(f"Teste falhou para: {query}")
ValueError: Teste falhou para: SELECT * FROM users

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\apps\savm\src\models\sqli_detector.py", line 392, in lifespan
    detector = SQLiDetector(config)
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\apps\savm\src\models\sqli_detector.py", line 202, in __init__
    self._verify_system()
  File "C:\apps\savm\src\models\sqli_detector.py", line 291, in _verify_system
    raise RuntimeError("Sistema não passou nos testes de verificação") from e
RuntimeError: Sistema não passou nos testes de verificação
2025-05-09 23:19:43,123 - uvicorn.error - ERROR - Traceback (most recent call last):
  File "C:\apps\savm\src\models\sqli_detector.py", line 288, in _verify_system
    raise ValueError(f"Teste falhou para: {query}")
ValueError: Teste falhou para: SELECT * FROM users

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\apps\savm\venv\Lib\site-packages\starlette\routing.py", line 692, in lifespan
    async with self.lifespan_context(app) as maybe_state:
  File "C:\Python312\Lib\contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\apps\savm\src\models\sqli_detector.py", line 392, in lifespan
    detector = SQLiDetector(config)
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\apps\savm\src\models\sqli_detector.py", line 202, in __init__
    self._verify_system()
  File "C:\apps\savm\src\models\sqli_detector.py", line 291, in _verify_system
    raise RuntimeError("Sistema não passou nos testes de verificação") from e
RuntimeError: Sistema não passou nos testes de verificação

2025-05-09 23:19:43,124 - uvicorn.error - ERROR - Application startup failed. Exiting.
2025-05-09 23:27:23,338 - uvicorn.error - INFO - Started server process [20924]
2025-05-09 23:27:23,339 - uvicorn.error - INFO - Waiting for application startup.
2025-05-09 23:27:23,342 - __main__ - INFO - Inicializando SQLiDetector...
2025-05-09 23:27:23,507 - __main__ - CRITICAL - Falha crítica na inicialização: Precisão do teste abaixo do mínimo aceitável (3 testes necessários)
2025-05-09 23:27:23,510 - uvicorn.error - INFO - Application startup complete.
2025-05-09 23:27:23,511 - uvicorn.error - INFO - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2025-05-09 23:35:11,029 - uvicorn.error - INFO - Shutting down
2025-05-09 23:35:11,182 - uvicorn.error - INFO - Finished server process [20924]
2025-05-09 23:35:11,277 - uvicorn.error - ERROR - Traceback (most recent call last):
  File "C:\apps\savm\src\models\sqli_detector.py", line 387, in lifespan
    if hasattr(self.model, 'predict_proba'):
       ^^^^^^^^^^^^^^^^^^^^
  File "C:\apps\savm\src\models\sqli_detector.py", line 205, in __init__
    }
  File "C:\apps\savm\src\models\sqli_detector.py", line 296, in _verify_system
RuntimeError: Precisão do teste abaixo do mínimo aceitável (3 testes necessários)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\apps\savm\src\models\sqli_detector.py", line 395, in lifespan
    result.update({
    ^^^^^
  File "C:\apps\savm\venv\Lib\site-packages\starlette\routing.py", line 699, in lifespan
    await receive()
  File "C:\apps\savm\venv\Lib\site-packages\uvicorn\lifespan\on.py", line 137, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\asyncio\queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\apps\savm\venv\Lib\site-packages\starlette\routing.py", line 692, in lifespan
    async with self.lifespan_context(app) as maybe_state:
  File "C:\Python312\Lib\contextlib.py", line 231, in __aexit__
    await self.gen.athrow(value)
  File "C:\apps\savm\src\models\sqli_detector.py", line 397, in lifespan
    'probability': proba,
  File "C:\Python312\Lib\logging\__init__.py", line 1539, in info
    self._log(INFO, msg, args, **kwargs)
  File "C:\Python312\Lib\logging\__init__.py", line 1684, in _log
    self.handle(record)
  File "C:\Python312\Lib\logging\__init__.py", line 1700, in handle
    self.callHandlers(record)
  File "C:\Python312\Lib\logging\__init__.py", line 1762, in callHandlers
    hdlr.handle(record)
  File "C:\Python312\Lib\logging\__init__.py", line 1011, in handle
    def handle(self, record):
    
KeyboardInterrupt

2025-05-09 23:35:20,097 - __main__ - INFO - Iniciando API em http://0.0.0.0:8000
2025-05-09 23:35:20,180 - uvicorn.error - INFO - Started server process [6288]
2025-05-09 23:35:20,181 - uvicorn.error - INFO - Waiting for application startup.
2025-05-09 23:35:20,181 - __main__ - INFO - Inicializando SQLiDetector...
2025-05-09 23:35:20,191 - __main__ - INFO - Vetorizador carregado de C:\apps\savm\src\models\text_features\vectorizer.joblib
2025-05-09 23:35:20,233 - __main__ - INFO - Modelo fallback carregado de C:\apps\savm\src\models\fallback_model.joblib
2025-05-09 23:35:20,284 - __main__ - WARNING - Teste nao esperado para: ' OR 1=1 -- (esperado: True, obtido: False)
2025-05-09 23:35:20,313 - __main__ - WARNING - Teste nao esperado para: SELECT 1 (esperado: False, obtido: True)
2025-05-09 23:35:20,335 - __main__ - WARNING - Teste nao esperado para: UPDATE users SET pass='123' (esperado: False, obtido: True)
2025-05-09 23:35:20,336 - __main__ - ERROR - Testes falharam (2/5 passaram)
2025-05-09 23:35:20,336 - __main__ - INFO - SQLiDetector inicializado com sucesso
2025-05-09 23:35:20,336 - uvicorn.error - INFO - Application startup complete.
2025-05-09 23:35:20,337 - uvicorn.error - INFO - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
